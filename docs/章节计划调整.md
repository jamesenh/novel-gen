# 章节计划生成策略（增量/可恢复）

本项目的章节计划以 `outline.json` 为上游，以 `chapters/chapter_XXX_plan.json` 为落盘结果，强调：

- **可增量**：新增章节（动态扩展大纲）后，仅为新增章节生成计划；
- **可恢复**：已有计划文件会被直接加载，避免重复生成；
- **可回滚**：可通过回滚删除某章之后的计划/场景/章节，再重新生成。

## 生成逻辑（以代码为准）

- 节点：`novelgen/runtime/nodes.py::chapter_planning_node`
- 输入：`world.json` + `theme_conflict.json` + `characters.json` + `outline.json`
- 输出：逐章写入 `projects/<project>/chapters/chapter_XXX_plan.json`

该节点会遍历 `outline.chapters`：

1. 若 `chapter_XXX_plan.json` 已存在 → 直接读取并载入；
2. 若不存在 → 调用 `novelgen/chains/chapters_plan_chain.py` 生成计划并落盘。

## 相关命令

- 查看详细状态与可回滚点：`ng state <project>`
- 回滚到第 N 章之前：`ng rollback <project> --chapter N`
- 回滚到第 N 章第 M 场景之前：`ng rollback <project> --chapter N --scene M`

## 延伸阅读

- 完整流程说明：`docs/小说生成完整流程说明.md`
- 章节循环/动态扩展实现：`docs/chapter_loop_workflow_implementation.md`
