---
alwaysApply: true
---

# Cursor 代码生成规范（只约束“怎么写代码”）

## 1) 语言与文档

- `docs/*.md`、用户可见说明：默认使用**中文**（术语可保留英文原名）。
- Python 代码：标识符/变量/函数名用**英文**；不要用拼音命名。
- Docstring：**必须**给公开模块/类/函数写 docstring；默认用**中文**。
- 注释说明: 使用**中文**
- 不新增花哨输出：CLI/日志避免新增 emoji 与装饰字符（保持可 grep/可解析）。

## 2) Python 代码风格（与仓库工具链对齐）

- 遵循 `ruff`（`pyproject.toml`）：行宽 88；保持 import 分组与排序（标准库/三方/本地）。
- 类型标注优先：新代码尽量完整标注参数与返回值；使用 `list[str]`/`dict[str, Any]`（Python 3.10+）。
- 避免一口气大重构：除非用户明确要求，否则只做最小必要改动。

## 3) Pydantic v2 与数据模型

- 使用 Pydantic v2 API：`model_validate(...)`、`model_dump(...)`，不要写 v1 风格的 `parse_obj`/`.dict()`。
- 结构化输出（JSON 资产）必须可被 schema 校验：新增/改字段时，同步更新对应 schema 与测试。

## 4) I/O 与编码（防资产污染）

- 所有文件读写显式 `encoding="utf-8"`。
- JSON 写入统一：`ensure_ascii=False`、`indent=2`；路径使用 `pathlib.Path`。
- 不引入隐式副作用：不要在 import 时执行 I/O；写盘逻辑要可测、可回滚、可定位。

## 5) 依赖与运行（uv 约束）

- 依赖管理优先使用 `uv`（例如 `uv sync` / `uv add` / `uv run`）；避免手改锁文件导致漂移。
- 非必要不新增依赖；如需新增，必须同时更新 `pyproject.toml` 与 `uv.lock`（以及必要时的 `requirements.txt`，按仓库现状保持一致）。

## 6) 测试与回归

- 改动涉及 `schemas`/`routing`/`plugins`：必须补/改对应 `pytest` 用例，保证契约与门禁逻辑可回归验证。
