## 1. Implementation

- [x] 1.1 设计并实现结构化意图对象（目标/范围/模式/置信度/缺失信息/是否需要澄清）
- [x] 1.2 实现 LLM 意图识别链：自然语言 → 结构化意图对象（Pydantic 结构化输出），并提供可配置模型与开关
- [x] 1.3 规则解析与 LLM 结果融合：优先信任可验证的范围解析；冲突时回显并进入澄清
- [x] 1.4 增加章节范围解析（中文数字与阿拉伯数字）：`前N章`、`第M章`、`第M-N章`、`从M到N章`、`到第N章` 等
- [x] 1.5 增加"计划 vs 正文"歧义澄清：例如"生成第3章"先问是章节计划还是章节正文
- [x] 1.6 增加"约束感知降级"分支：识别到范围但工具不支持精确执行时，必须提示限制并提供选项，禁止静默扩张范围
- [x] 1.7 执行前回显解析结果与拟执行计划（并接入确认策略）
- [x] 1.8 更新文档与自然语言示例覆盖范围指令

## 2. Validation

- [x] 2.1 单元测试：LLM 意图识别结构化输出（使用 mock/fake LLM，不依赖真实网络）
- [x] 2.2 单元测试：章节范围解析（含中文数字/边界/非法输入）
- [x] 2.3 对话回归用例（建议覆盖以下输入）：
  - `生成前3章的章节计划`
  - `生成第2-5章的章节计划` / `生成2到5章的章节计划`
  - `生成前三章的章节计划` / `生成第十章` / `生成第十二章到第十五章`（中文数字）
  - `生成第3章`（必须澄清：计划 vs 正文）
  - `继续生成到第5章`（提取范围并回显；能力不足时走降级）
  - `先把后面几章规划一下` / `把中间几章补上`（必须澄清缺失范围）
  - LLM 不可用/失败时同样行为正确（回退规则 + 澄清，不扩张）
- [x] 2.4 OpenSpec：`openspec validate update-chat-intent-scope-parsing --strict` 通过
